---
title: "Comenzando con R"
author: "Fernando Salcedo Mej√≠a, ALZAK Foundation"
date: 2023-08-19
format: 
  revealjs :
    logo: "src/alzak_foundation.png"
    footer: "Copyright (c) 2023, Fernando Salcedo"
    scrollable: true
    margin: 0
execute:
  echo: true
enbeded: true
---

## Aritm√©tica con `R`

- `R` puede ser usado como una simple calculadora

```{r}
# Suma
5 + 5 

# Resta
10 - 5 

# Multiplicaci√≥n
3 * 5

# Divisi√≥n 
(5 + 5) / 2 

# Potencia
2^5

# M√≥dulo. (Remanente de dividir 28 entre 6)
28%%6

```

## Asignar valores

- Podemos crear **variables** asign√°ndoles valores usando `<-`

- `r emoji::emoji("police_car_light")` `R` no reemplaza, sobrescribe o modifica un elemento si no usamos `<-`

```{r}
# Variable edad
edad <- 32

# ver el contenido de la variable
edad

# usando el comando print()
print(edad)

```

## Asignar valores II

- Podemos hacer operaciones aritm√©ticas entre variables solo usando sus nombres.

```{r}
# edad de Jos√©
edad_jose <- 45

# edad Mar√≠a
edad_maria <- 34

# diferencia de edades entre Mar√≠a y Jos√©
edad_jose -  edad_maria

```

## Tipo de datos en `R`

- `R` trabaja con numerosos tipos de datos. Los tipos m√°s b√°sicos son:
  - `numerics` como `1.5`
  - `integers` como 4
  - `logical` solo valores `TRUE` y `FALSE`
  - `characters` como `"introducci√≥n a R"`
  - `date` como `2023-08-01` (`R` solo usa formato YYYY-MM-DD para las fechas)
  
```{r}
# valor numerico
peso_maria <- 78.4

# valor entero
n_carros <- 12L

# valor logico
es_dia <- TRUE

# valor de texto
direccion_casa <- "CLL 34 # 56-4A"

# valor de fecha
fecha_hoy <- Sys.Date() # Sys.Date() es a fecha de hoy

```

```{r}
# clases de variables
class(peso_maria)
class(n_carros)
class(es_dia)
class(direccion_casa)
class(fecha_hoy)

```

## Vectores üî¢

- `R` trabaja con estructuras de datos. La estructua de datos m√°s simple es un *vector*
- Un *vector* es una colecci√≥n de elementos (n√∫mero, texto, fechas, l√≥gico)
- Usamos el operador `c()` para crear un vector

```{r}
# ingresos en dolares
# vectores de edad y nombres
edades <- c(12, 23, 36, 45)
nombres <- c("Carlos", "Mar√≠a", "Jos√©", "Manuel")

edades
nombres

```

## Operaciones con vectores

- El vector tiene un n√∫mero de elementos (`length()`) y posici√≥n (`[]`) de esos elementos

```{r}
length(edades) # n√∫mero de elementos
edades[2] # mostrar el elemento en la posici√≥n 2
```

## Nombres elementos de un vector

- Es posible asignar nombres a los elementos de un vector `names()`

```{r}
# asignamos un vector de car√°cter del mismo largo del vector de edades
names(edades) <- nombres 
edades
edades["Carlos"] # ver la edad de Carlos
names(edades) # si usamos names() obtenemos los nombres
names(edades)[2] <- "Julia" # cambiar el nombre para el segundo elemento
edades # vemos los cambios
```

## Operaciones aritm√©ticas de vectores I

- Podemos hacer operaciones con vectores num√©ricos
- Los elementos se operan desde la misma posici√≥n

```{r}
# vectores de ingresos y gastos
ingresos <- c(34, 44, 48, 90, 56)
gastos <- c(23, 53, 37, 97, 34)
meses <- c("Enero", "Febrero", "Marzo", "Abril", "Mayo")
# nombres mes
names(ingresos) <- meses
names(gastos) <- meses

ingreso_disponible <- ingresos - gastos
ingreso_disponible
```


## Operaciones aritm√©ticas de vectores II

- Podemos hacer operaciones de **resumen** vectores num√©ricos

```{r}
# minimo ingreso
min(ingresos)
# maximo ingreso
max(ingresos)
# total de ingresos
sum(ingresos)
# ingresos promedios
mean(ingresos)
```

## Prueba lo que has aprendido üß†

- Usando el vector de ingresos y gastos, ¬øcuanto es el total de ingreso disponible en los 5 meses (Enero-Mayo)?

## Soluci√≥n ‚úÖ

```{r}
total_ingresos <- sum(ingresos)
total_gastos <- sum(gastos)
total_ingresos_disponibles <- total_ingresos - total_gastos
total_ingresos_disponibles
```

## Secuencias y creaci√≥n r√°pida de vectores

- Podemos hacer secuencias de elementos con comando `seq()`
- Si la secuencia es de uno a uno usamos el operador `:`
- Podemos crear vectores repitiendo elementos `rep()`

```{r}
(x <- seq(from = 1, to = 20)) # secuencia de n√∫mero de 1 al 20
(x <- 1:20) # versi√≥n r√°pida
(x <- seq(2, 20, by = 2)) # secuencia de n√∫mero de 1 al 20 incrementando por 2
```

## Secuencias y creaci√≥n r√°pida de vectores

```{r}
(y <- rep(x, 2)) # repetir el vector 2 veces
(y <- rep(x, each = 2)) # repetir cada elemento 2 veces
```

## Prueba lo que has aprendido üß†

- Su compa√±ero de clases quiere crear una secuencia de n√∫meros de **cinco en cinco** hasta el 100. ¬øC√≥mo lo puede hacer en `R`?

## Soluci√≥n ‚úÖ

```{r}
seq(5, 100, by = 5)
```

## Vectores de caracteres

- Los caracteres se colocan entre comillas `hola`
- El comando `paste()` y `paste0()` permite combinar vectores de caracteres

```{r}
nombres <- c("Carlos", "Mar√≠a", "Jos√©", "Manuel")
apellidos <- c("Sanchez", "Mej√≠a", "Valencia", "Mora") 
nombres_completos <- paste(nombres, apellidos) # combinamos los nombres y apellidos en nuevo vector
nombres_completos
```

## Mayusculas y minusculas

- Para pasar de min√∫sculas a may√∫sculas usamos `toupper()`
- Ahora de may√∫sculas a min√∫sculas `tolower()`

```{r}
toupper(nombres)
tolower(nombres)
```

## Vector l√≥gico y operadores {.scrollable .smaller}

- Desigualdades `<, <=, >, >=`
- Identidad `==`
- Inequidad o negaci√≥n `!=`
- Dos vectores `c1` y `c2` son vectores l√≥gicos
  - `c1 & c2` es la intercepci√≥n o conjugaci√≥n "Y"
  - `c1 | c2` es la uni√≥n "O"
  - `!c1` ser√≠a la negaci√≥n, convirtiendo `TRUE -> FALSE` y viceversa
  - `c1 %in% c2` es la operaci√≥n coincidir elementos de `c1` en `c2`

- Un vector l√≥gico contiene valores FALSO (`FALSE`) y VERDADERO (`TRUE`)
- Tambi√©n evaluar una condici√≥n sobre un vector devuelve un vector l√≥gico.

```{r}
5 > 2 # TRUE
x <- 1:20 
x > 10 # elementos del vector de 1 al 20 que cumplen la condici√≥n
(y <- x > 10)
```

## Vector de fechas

- Las fechas en `R` usan el formato YYYY-MM-DD
- Para ingresar una fecha usamos el comando `as.Date()`
- Si queremos la fecha de hoy usamos `Sys.Date()`

```{r}
(x <- as.Date(c("2021-01-12", "2021-01-01", "2021-04-12")))
class(x)
(x <- Sys.Date() + 1:5) # vector de fechas a patir de hoy
```


## Valores perdidos

- Un valor perdido no es m√°s que un valor ausente en un vector
- Se usa para representarlo `NA`
- El comando `is.na()` eval√∫a si en un vector hay datos perdidos

```{r}
x <- c(1:5, NA)
is.na(x) # comprueba si los valores son NA
```

## Indexaci√≥n y segmentaci√≥n üçø {.scrollable .smaller}

- Los operadores l√≥gicos nos permiten seleccionar los elementos de un vector que cumplen una condici√≥n (operadores l√≥gicos!) üö®
- La forma de usarlo es con los corchetes `[]`
- Tambi√©n podemos eliminar un elemento de un vector con el signo menos (`-`) y la posici√≥n del elemento

```{r}
# ingresos mayores que el promedio
mejores_ingresos <- ingresos > mean(ingresos)
ingresos[mejores_ingresos]

# no sabemos el valor de ingresos para el mes de Enero
ingresos["Enero"] <- NA
ingresos[1] <- NA
ingresos

# ingresos sin valores perdidos (NA)
# negar la condici√≥n devuelve TRUE donde antes era FALSE
ingresos[!is.na(ingresos)] 

# eliminar del vector de ingresos el primer mes
ingresos[-1]

```

## Reemplazar valores en un vector

- Para reemplazar un valor dentro de un vector usamos
  - Posici√≥n `x[index] <- valor`
  - Condiciones `x[x > valor1]<- valor2`

```{r}
# reemplazar el mes de enero con otro valor
ingresos[1] <- 120
ingresos["Enero"] <- 120

ingresos

```

## Posici√≥n de elementos por condici√≥n

- Podemos identificar la posici√≥n de un valor dentro de un vector usando `which()`, `which.max()`, `which.min()` 

```{r}

# posicion ingresos menores que el promedio
i_menor_ingreso <- which(ingresos < mean(ingresos))
i_menor_ingreso
ingresos[i_menor_ingreso]

# mes con el peor ingreso
ingresos[which.min(ingresos)]

# mes con el mejor ingreso
ingresos[which.max(ingresos)]

```

## Coercionar vectores de tipo ü•ä

- Para cambiar un vector `character -> numeric` usamos `as.numeric()`
- Para cambiar un vector `numeric ->` usamos `as.character()`

```{r}
x <- c("1", "3", "a", "7")
(x <- as.numeric(x)) # tenemos datos NA
class(x)
x <- 1:4
(x <- as.character(x)) # notemos que los n√∫meros est√°n entre comillas
class(x)
```


## Ordenar elementos de un vector üìè

- Para ordenar usamos el comando `sort()`

```{r}
temp <- c(34, 55, 45, 34, 22, 10)

# ordenar de menos a mayor
sort(temp)

# ordenar de mayor a menor
sort(temp, decreasing = TRUE)

```

## Veamos lo que has aprendido üß†

- Ahora su amigo quiere que lo ayude con este vector de nombres `c("Mar√≠a", "Pedro", "Juan")`. 
- √âl necesita que cada nombre se repita tres veces en el orden que est√°n cada nombre pero que adem√°s se repita dos veces todo el vector de nombres, tal que obtenga esto : `"Mar√≠a", "Mar√≠a", "Mar√≠a", "Pedro", "Pedro", "Pedro", "etc"`. ¬øC√≥mo lo puede hacer en `R`?

## Soluci√≥n ‚úÖ

```{r}
nombres <- c("Mar√≠a", "Pedro", "Juan")
rep(nombres, each = 3, times = 2)
```

## Veamos lo que has aprendido üß†

1. Usted tiene la temperatura promedio de cada mes de un a√±o `temp <- c(22.52, 18.70, 19.61, 22.79, 29.38, 30.19, 33.16, 36.97, 33.29, 28.98, 24.31, 22.43)`
- Cree un vector con los nombre de los meses y asigne los nombres al vector `temp`
- ¬øMeses con la mayor y menor temperatura?
- ¬øMeses con temperaturas mayores que 30 grados? 
- ¬øMeses con temperaturas entre 35 y  40 grados? 

## Soluci√≥n ‚úÖ

```{r}
# - Cree un vector con los nombre de los meses y asigne los nombres al vector `temp`
temp <- c(22.52, 18.70, 19.61, 22.79, 29.38, 30.19, 33.16, 36.97, 33.29, 28.98, 24.31, 22.43)
names(temp) <- c("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre")

# - ¬øMeses con la mayor y menor temperatura?
temp[temp == min(temp)]
temp[temp == max(temp)]

# - ¬øMeses con temperaturas mayores que 30 grados? 
temp[temp > 30]

# - ¬øMeses con temperaturas entre 35 y  40 grados? 
temp[temp > 35 & temp < 40]

```


## Matrices üç±

- Es una colecci√≥n de valores del mismo tipo arreglados en filas y columnas
- Para crear matrices se usa el comando `matrix()`

```{r}
calificaciones <- matrix(c(5, 5, 2, 0, 4,
                           4, 3, 1, 1, 5,
                           3, 3, 0, 3, 0), byrow = TRUE, ncol = 3)

rownames(calificaciones) <- c("Carlos", "Mar√≠a", "Jos√©", "Manuel", "Antonio")
colnames(calificaciones) <- c("Matem√°ticas", "Idiomas", "Sociales")

calificaciones
```

## Dimensiones de una matriz

- Usamos el comando `dim()` para saber el n√∫mero de filas y columnas

```{r}
dim(calificaciones)
```


## Extraer elementos de una matriz

- Usamos la posici√≥n de fila y columnas `[i, j]` para extraer una fila, columna o elemento de las matriz

```{r}
# calificaciones de Matem√°ticas
calificaciones[,"Matem√°ticas"]

# calificaciones de Carlos
calificaciones["Carlos", ]

# calificaci√≥n de Mar√≠a en Idiomas
calificaciones["Mar√≠a", "Idiomas"]

```

## Operaciones y resumen de matrices

- Podemos aplicar operaciones a las columnas y filas de las matrices con `rowSums()`, `rowMeans()`, `colSums()`, `colMeans()`

```{r}
# promedio de calificaciones por estudinate
rowMeans(calificaciones)
# promedio de calificiaciones por metria
colMeans(calificaciones)
```


## `data.frames` o cuadros de datos

- Un `data.frame` es un arreglo de vectores en filas y columnas de distintos tipos
- En contexto, las filas son observaciones y las columnas variables
- Para crear un `data.frame` usamos el comando `data.frame()`

```{r}
# cada variable es un vector y debe  ser del mismo largo
df_encuesta <- data.frame(
  id = 1:10, 
  sexo = c("F", "F", "M", "M", "F", "M", "M", "F", "M", "F"),
  edad = c(19, 45, 24, 19, 34, 20, 67, 34, 35, 10),
  ingresos = c(120, 134, 198, 455, 678, 564, 123, 632, 90, 124)
)

df_encuesta
class(df_encuesta) # nueva clase, data.frame
```

## Atributos de un `data.frame`

- Para el n√∫mero de filas o observaciones usamos `nrow()`
- Para el n√∫mero de variables o columnas usamos `ncol()`
- Para los nombres de las variables usamos `names()`
- La estructura del `data.frame` la vemos con `str()`

```{r}
nrow(df_encuesta) # filas del data.frame
ncol(df_encuesta) # columnas del data.frame
names(df_encuesta) # nombres de las variables
str(df_encuesta) # vista de la estructura del data.frame
```

## Formas de ver un `data.frame`

- No es necesario ver todo un `data.frame` para entender c√≥mo es la estructura o qu√© contiene
- Para ver el encabezado usamos `head()`
- Para ver las √∫ltimas filas usamos `tail()`
- Si queremos verlo al detalle completo usar `Views()`

```{r}
head(df_encuesta) # primeras 6 observaciones
tail(df_encuesta) # ultimas 6 observaciones
# View(df_encuesta) # ver todos los datos
```


## Cambiar los nombres de un `data.frame`

- Tal como en los vectores, usamos `names(df)[index] <- "nuevo_nombre"`

```{r}
names(df_encuesta)[1] <- "identificacion" # siempre entre comillas el nuevo nombre
names(df_encuesta)
```

## Algunas recomendaciones de los nombres en el `data.frame` `r emoji::emoji("face with monocle")`

- Nombres cortos, c√≥digo corto y sencillo
- Para nombres con espacios usar `"_"` como por ejemplo `codigo_paciente`. Esto es m√°s f√°cil de leer que `codigopaciente`
- Evitar usar `"."` como separador de espacios en los nombres (`nombre.paciente`), debido a que hay funciones con ese car√°cter
- **No repetir el nombre** de una variable en el mismo `data.frame`

## Selecci√≥n de filas y variables en un `data.frame`

- Para ello, usamos los corchetes `[]`
- Para seleccionar variables usamos `df["nombre_variable"]` o la posici√≥n `df[index]`
- Para seleccionar filas usamos `df[index, ]`

```{r}
df_encuesta["sexo"] # solo la variable sexo con todas las observaciones
df_encuesta[1, ] # solo la primera observaci√≥n con todas las variables
df_encuesta[c("identificacion", "sexo")] # solo las variables identificaci√≥n y sexo con todas las observaciones
df_encuesta[1:3, ] # solo las primeras tres observaciones
```


## Operador `$` y `[[]]`

- `$` y `[[]]` permite extraer una columna de un `data.frame` como vector

```{r}
# vector de edades
edades_encuesta <- df_encuesta$edad
edades_encuesta
# vector de ingresos 
ingreso_encuesta <- df_encuesta[["ingresos"]]
ingreso_encuesta
```


## Cambio de orden en un `data.frame`

- Si queremos ordenar un `data.frame` por alguna variable usamos `order()`
- Para cambiar el orden de las variables usamos `cbind()` o indexamos por un vector de nombres `df[vector_nombres]`

```{r}
# ordenar por edad de menor a mayor
df_encuesta[order(df_encuesta$edad), ]
# ordenar por edad de mayor a menor
df_encuesta[order(df_encuesta$edad, decreasing = TRUE), ]
```

## Segmentaci√≥n de `data.frames`

- Para filtrar filas dentro de un `data.frame` usamos los operadores l√≥gicos
- Tal como vimos en los vectores y la indexaci√≥n, las **filas que cumplan la condici√≥n son las que se muestran (`TRUE`)**
- Si vamos a usar muchas condiciones conviene usar el comando `subset()`

```{r}
# filtrar las observaciones del sexo F
df_encuesta[df_encuesta$sexo == "F", ]

# usando el comando subset()
subset(df_encuesta, sexo == "F")

# filtrar las observaciones del sexo M y edades >= 30
df_encuesta[df_encuesta$edad >= 30 & df_encuesta$sexo == "M", ] 
subset(df_encuesta, edad >= 30 & sexo == "M")
```

## Agregar una nueva variable al `data.frame`

- Usamos el operador `$` o `[[]]` para crear una variable nueva en el `data.frame`

```{r}
df_encuesta$gastos <- c(72, 43, 30, 406, 364, 178, 7, 449,  13,  43)

df_encuesta

```

## Reemplazar valores en un `data.frame`

- Se reemplazan valores que cumplen una condici√≥n

```{r}
# reemplazar la edad en el id = 1
df_encuesta$edad[df_encuesta$id == 1] <- 34
df_encuesta
```


## Prueba lo aprendido üß†

1. Tenemos el siguiente `data.frame`

```
df_quiz <- data.frame(
  id = 1:4, 
  SEXOXO = c("F", "M", "M", "F"),
  edad = c(45, 34, 20, NA),
  ingresos  = c(120, 50, 240, 456)
)
```
- ¬øCuantas filas y columnas tiene? H√°galo con `R`
- Corrija el nombre de la variable `SEXOXO` por el adecuado.
- Reemplazar el valor de la edad perdido (`NA`) a 50 para el id == 4.
- ¬øCuantos `id`son hombres y tienen de ingresos > 75.
- Cree otro `data.frame` solo para las mujeres.

## Soluci√≥n ‚úÖ

```{r}

df_quiz <- data.frame(
  id = 1:4, 
  SEXOXO = c("F", "M", "M", "F"),
  edad = c(45, 34, 20, NA),
  ingresos  = c(120, 50, 240, 456)
)

# - ¬øCuantas filas y columnas tiene? H√°galo con `R`
nrow(df_quiz)
# - Corrija el nombre de la variable `SEXOXO` por el adecuado.
names(df_quiz)[2] <- "sexo"
# - ¬øCuantos `id`son hombres y tienen de ingresos > 75.
subset(df_quiz, sexo == "M" & ingresos > 75)
# - Cree otro `data.frame` solo para las mujeres.
df_quiz_F <- subset(df_quiz, sexo == "F")

```


## Listas `r emoji::emoji("straight ruler")`

- Las listas son un arreglo de elementos de distintos tipos y es otra estructura de datos.
- Su uso est√° destinado a agrupar en un solo objeto diversidad de elementos que tengan alguna relaci√≥n pero que **no se pueden combinar**

```{r}

df_ventas <- data.frame(
    id_producto = c(5, 1, 1, 2, 5, 4, 1, 5, 1, 2),
    cantidad = c(81, 52, 23, 8, 17, 84, 84, 65, 60, 2)
  )

df_productos <- data.frame(
    id_producto = 1:5,
    descripcion = c("Leche", "Carne", "Huevos", "Pan", "Harina"),
    medida = c("ml", "gr", "und", "und", "gr")
  )

 df_precios <- data.frame(
    id = 1:5,
    precio = c(134, 345, 190, 34, 12)
  )

# lista de ventas
list_ventas <- list(
  ventas = df_ventas,
  productos = df_productos,
  precios = df_precios
)

# estructura 
str(list_ventas, max.level = 1)
str(list_ventas, max.level = 2)

```

## Manipulaci√≥n de listas `r emoji::emoji("book")`

- Las listas son colecciones de objetos ordenados en secuencia `list()`
- Las listas nos permiten tener diferentes objetos tal como un `vector`o un `data.frame`

```{r}
# numero de elementos
length(list_ventas)
# nombres de los objetos en la lista
names(list_ventas)
# ver un objeto dentro de una lista
list_ventas[[1]]
list_ventas[["ventas"]]
list_ventas$ventas
list_ventas$ventas$cantidad
```


